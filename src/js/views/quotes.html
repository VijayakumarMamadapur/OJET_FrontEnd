<div class="oj-flex oj-sm-flex-direction-column oj-sm-align-items-start">
  <h2>Quotes</h2>

  <oj-messages messages="[[messages]]"></oj-messages>

  <!-- Admin Filters -->
  <oj-bind-if test="[[isAdmin()]]">
    <oj-form-layout>
      <oj-select-single label-hint="Filter by Customer" data="[[customersDP]]" item-text="fullName" value="{{filterCustomerId}}"></oj-select-single>
      <oj-select-single label-hint="Filter by Status" data="[[statusDP]]" value="{{filterStatus}}"></oj-select-single>
      <oj-button on-oj-action="[[applyFilter]]">Apply Filter</oj-button>
    </oj-form-layout>
  </oj-bind-if>

  <!-- Create Quote -->
  <oj-button on-oj-action="[[function() { document.getElementById('createQuoteDialog').open(); }]]">
    Create Quote
  </oj-button>

  <!-- Admin Actions -->
  <div style="margin-top:12px; margin-bottom:8px;" data-bind="visible: isAdmin()">
    <oj-button on-oj-action="[[editSelectedQuote]]">Edit Selected</oj-button>
    <oj-button on-oj-action="[[priceCheckedRows]]">Price Selected</oj-button>
    <oj-button on-oj-action="[[confirmCheckedRows]]">Confirm Selected</oj-button>
    <oj-button on-oj-action="[[deleteSelected]]">Delete Selected</oj-button>
  </div>

  <!-- User Action: Acknowledge Payment (simple ACK flag) -->
  <oj-bind-if test="[[!isAdmin()]]">
    <div style="margin-top:12px; margin-bottom:8px;">
      <oj-button disabled="[[!(selectedQuote() && selectedQuote().status === 'PRICED' && selectedQuote().pricingSource !== 'ACK')]]"
                 on-oj-action="[[ackSelectedPayment]]">
        I Have Paid
      </oj-button>
    </div>
  </oj-bind-if>

  

  <!-- Quotes Table -->
  <oj-table aria-label="Quotes" data="[[quotesDP]]" selection-mode='{"row":"single"}' current-row="{{selectedRow}}" columns="[[columns]]">
    <template slot="selectTpl" data-oj-as="cell">
      <input type="checkbox" onclick="event.stopPropagation();" data-bind="checked: cell.item.data.selected" />
    </template>
  </oj-table>

  <!-- Create Quote Dialog -->
  <oj-dialog id="createQuoteDialog" dialog-title="Create Quote" chromeless="true">
    <div slot="body">
      <oj-form-layout>
        <oj-bind-if test="[[isAdmin()]]">
          <oj-select-single label-hint="Customer" data="[[customersDP]]" item-text="fullName" value="{{newQuote.customerId}}"></oj-select-single>
        </oj-bind-if>
        <oj-select-single label-hint="Product" data="[[productsDP]]" item-text="name" value="{{newQuote.productId}}"></oj-select-single>
        <oj-input-text label-hint="Sum Assured" value="{{newQuote.sumAssured}}"></oj-input-text>
        <oj-input-text label-hint="Term Months" value="{{newQuote.termMonths}}"></oj-input-text>
      </oj-form-layout>
    </div>

    <div slot="footer">
      <oj-button on-oj-action="[[createQuote]]">Save</oj-button>
      <oj-button on-oj-action="[[function() { document.getElementById('createQuoteDialog').close(); }]]">Cancel</oj-button>
    </div>
  </oj-dialog>

  <!-- Update Quote Dialog -->
  <oj-dialog id="updateQuoteDialog" dialog-title="Update Quote" chromeless="true">
    <div slot="body">
      <oj-form-layout>
        <oj-input-text label-hint="Sum Assured" value="{{editQuote().sumAssured}}"></oj-input-text>
        <oj-input-text label-hint="Term Months" value="{{editQuote().termMonths}}"></oj-input-text>
      </oj-form-layout>
    </div>
    <div slot="footer">
      <oj-button on-oj-action="[[updateSelectedQuote]]" chroming="callToAction">Save</oj-button>
      <oj-button on-oj-action="[[function(){ document.getElementById('updateQuoteDialog').close(); }]]">Cancel</oj-button>
    </div>
  </oj-dialog>

</div>
